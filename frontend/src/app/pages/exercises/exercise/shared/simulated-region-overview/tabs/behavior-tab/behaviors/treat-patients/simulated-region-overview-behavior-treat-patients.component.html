<div class="table">
    <div
        class="row"
        (click)="settingsCollapsed = !settingsCollapsed"
        style="cursor: pointer"
    >
        <h4>
            <i
                *ngIf="settingsCollapsed; else settingsExpanded"
                class="bi bi-caret-right-fill"
            ></i>
            <ng-template #settingsExpanded
                ><i class="bi bi-caret-down-fill"></i
            ></ng-template>
            Einstellungen
        </h4>
    </div>
    <div
        class="row"
        #collapse="ngbCollapse"
        [(ngbCollapse)]="settingsCollapsed"
    >
        <h5 class="mt-2">
            Häufigkeit der Neuzuteilung in den jeweiligen Zuständen
        </h5>
    </div>
    <div
        class="row align-items-center"
        #collapse="ngbCollapse"
        [(ngbCollapse)]="settingsCollapsed"
    >
        <div class="col-sm">Unbekannt</div>
        <div class="col-sm">
            <div
                title="Wie häufig neu zugeteilt werden soll, wenn das Personal grade angekommen ist."
                class="input-group input-group-sm float-start"
                style="max-width: 250px"
            >
                <!-- The input is in seconds -->
                <input
                    #timeInput="ngModel"
                    [ngModel]="
                        treatPatientsBehaviorState.intervals.unknown / 1000
                    "
                    (appSaveOnTyping)="
                        updateTreatPatientsBehaviorState(
                            $event * 1000,
                            -1,
                            -1,
                            -1,
                            -1
                        )
                    "
                    min="0"
                    required
                    step="1"
                    type="number"
                    class="form-control form-control-sm d-inline-block no-validation"
                    data-cy="alarmGroupVehicleDelayInput"
                />
                <span class="input-group-text">Sec</span>
            </div>
        </div>
    </div>
    <div
        class="row align-items-center"
        #collapse="ngbCollapse"
        [(ngbCollapse)]="settingsCollapsed"
    >
        <div class="col-sm">Gezählt</div>
        <div class="col-sm">
            <div
                title="Wie häufig neu zugeteilt werden soll, wenn das Zählen der Patienten abgeschlossen ist."
                class="input-group input-group-sm float-start"
                style="max-width: 250px"
            >
                <!-- The input is in seconds -->
                <input
                    #timeInput="ngModel"
                    [ngModel]="
                        treatPatientsBehaviorState.intervals.counted / 1000
                    "
                    (appSaveOnTyping)="
                        updateTreatPatientsBehaviorState(
                            -1,
                            $event * 1000,
                            -1,
                            -1,
                            -1
                        )
                    "
                    min="0"
                    required
                    step="1"
                    type="number"
                    class="form-control form-control-sm d-inline-block no-validation"
                    data-cy="alarmGroupVehicleDelayInput"
                />
                <span class="input-group-text">Sec</span>
            </div>
        </div>
    </div>
    <div
        class="row align-items-center"
        #collapse="ngbCollapse"
        [(ngbCollapse)]="settingsCollapsed"
    >
        <div class="col-sm">Vorgesichtet</div>
        <div class="col-sm">
            <div
                title="Wie häufig neu zugeteilt werden soll, nachdem das Personal vorgesichtet."
                class="input-group input-group-sm float-start"
                style="max-width: 250px"
            >
                <!-- The input is in seconds -->
                <input
                    #timeInput="ngModel"
                    [ngModel]="
                        treatPatientsBehaviorState.intervals.triaged / 1000
                    "
                    (appSaveOnTyping)="
                        updateTreatPatientsBehaviorState(
                            -1,
                            -1,
                            $event * 1000,
                            -1,
                            -1
                        )
                    "
                    min="0"
                    required
                    step="1"
                    type="number"
                    class="form-control form-control-sm d-inline-block no-validation"
                    data-cy="alarmGroupVehicleDelayInput"
                />
                <span class="input-group-text">Sec</span>
            </div>
        </div>
    </div>
    <div
        class="row align-items-center"
        #collapse="ngbCollapse"
        [(ngbCollapse)]="settingsCollapsed"
    >
        <div class="col-sm">Erstversorgung sichergestellt</div>
        <div class="col-sm">
            <div
                title="Wie häufig neu zugeteilt werden soll, nachdem die Erstversorgung sichergesetellt ist."
                class="input-group input-group-sm float-start"
                style="max-width: 250px"
            >
                <!-- The input is in seconds -->
                <input
                    #timeInput="ngModel"
                    [ngModel]="
                        treatPatientsBehaviorState.intervals.secured / 1000
                    "
                    (appSaveOnTyping)="
                        updateTreatPatientsBehaviorState(
                            -1,
                            -1,
                            -1,
                            $event * 1000,
                            -1
                        )
                    "
                    min="0"
                    required
                    step="1"
                    type="number"
                    class="form-control form-control-sm d-inline-block no-validation"
                    data-cy="alarmGroupVehicleDelayInput"
                />
                <span class="input-group-text">Sec</span>
            </div>
        </div>
    </div>
    <div class="row">
        <h5
            class="mt-2"
            #collapse="ngbCollapse"
            [(ngbCollapse)]="settingsCollapsed"
        >
            Weiteres
        </h5>
    </div>
    <div
        class="row align-items-center"
        #collapse="ngbCollapse"
        [(ngbCollapse)]="settingsCollapsed"
    >
        <div class="col-sm">Zähldauer pro Patient</div>
        <div class="col-sm">
            <div
                title="Wie lange es dauert, einen Patienten zu zählen."
                class="input-group input-group-sm float-start"
                style="max-width: 250px"
            >
                <!-- The input is in seconds -->
                <input
                    #timeInput="ngModel"
                    [ngModel]="
                        treatPatientsBehaviorState.intervals
                            .countingTimePerPatient / 1000
                    "
                    (appSaveOnTyping)="
                        updateTreatPatientsBehaviorState(
                            -1,
                            -1,
                            -1,
                            -1,
                            $event * 1000
                        )
                    "
                    min="0"
                    required
                    step="1"
                    type="number"
                    class="form-control form-control-sm d-inline-block no-validation"
                    data-cy="alarmGroupVehicleDelayInput"
                />
                <span class="input-group-text">Sec</span>
            </div>
        </div>
    </div>
    <div class="row"><h4>Informationen</h4></div>
    <div class="row">
        <h5 class="mt-2">Allgemein</h5>
    </div>
    <div class="row align-items-center">
        <div class="col-sm">Derzeitige Phase</div>
        <div class="col-sm">
            {{
                treatPatientsBehaviorState.treatmentProgress
                    | treatmentProgressToGermanName
            }}
        </div>
    </div>

    <div class="row" *ngIf="((patientIds$ | async) ?? []).length > 0">
        <h5 class="mt-2">Derzeitige Zuordnung</h5>
    </div>

    <div
        class="row align-items-center"
        *ngIf="((patientIds$ | async) ?? []).length > 0"
    >
        <div class="col-sm justify-content-center">
            <h6 class="text-center">Name</h6>
        </div>
        <div class="col-sm justify-content-center">
            <h6 class="text-center">Realer Status</h6>
        </div>
        <div class="col-sm justify-content-center">
            <h6 class="text-center">Sichtbarer Status</h6>
        </div>
        <div
            *ngIf="treatPatientsBehaviorState.treatmentProgress !== 'unknown'"
            class="col-sm justify-content-center"
        >
            <h6 class="text-center">Zugeteiltes Personal</h6>
        </div>
    </div>
    <div *ngFor="let patientId of patientIds$ | async" class="row">
        <div>
            <app-simulated-region-overview-behavior-treat-patients-patient-details
                [patientId]="patientId"
                [cateringsActive]="
                    treatPatientsBehaviorState.treatmentProgress !== 'unknown'
                "
                class="row align-items-center"
                style="
                    padding-left: 0;
                    padding-right: 0;
                    overflow-x: auto;
                    flex-wrap: nowrap;
                "
            ></app-simulated-region-overview-behavior-treat-patients-patient-details>
        </div>
    </div>
</div>
